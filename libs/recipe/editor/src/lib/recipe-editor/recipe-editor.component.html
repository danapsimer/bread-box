<form [formGroup]='form' (ngSubmit)='onSubmit'>
  <label>
    Name:
    <input type='text' formControlName='name'>
  </label>

  <p></p>

  <div formArrayName='ingredients'>
    <div *ngFor='let ingredient of ingredients.controls; let i=index' [formGroupName]='i'>
      <label>
        Ingredient Name:
        <select formControlName='ingredientId'>
          <option *ngFor='let availIngredient of availableIngredients$ | async'
                  [value]='availIngredient.id'>
            {{availIngredient.name}}
          </option>
        </select>
      </label>
      <label>
        Quantity:
        <input type='number' formControlName='quantity' />
      </label>
      <label>
        Unit:
        <select formControlName='unit'>
          <option *ngFor='let unit of units$ | async' [value]='unit.id'>{{ingredients.at(i).get('quantity').value > 1 ? unit.plural : unit.name}}</option>
        </select>
      </label>
      <button type='button' (click)='deleteIngredient(i)'>Delete</button>
    </div>
  </div>

  <button type='button' (click)='addIngredient()'>Add Ingredient</button>

  <p>
    <button type='submit' [disabled]='!form.valid'>Submit</button>
  </p>
  <p>
    {{ form.value | json }}
  </p>
  <p>
    Form Status: {{ form.status }}
  </p>
</form>
